<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>音乐播放功能实现 - 1</title>
      <link href="/2026/01/20/20260120/"/>
      <url>/2026/01/20/20260120/</url>
      
        <content type="html"><![CDATA[<h1 id="音乐播放功能实现"><a href="#音乐播放功能实现" class="headerlink" title="音乐播放功能实现"></a>音乐播放功能实现</h1><img src="/assest/20260120/1.png" alt="listImg"/><p>音乐播放器我们将这个组件拆分成 4块来看，左侧歌曲名称图片，中间控制audio的暂停播放切歌，右侧是音乐的长度和当前播放的时间还有音量，最后就是上面的进度条。</p><p>这章我们首先介绍中间部分控制音乐播放的实现和时间的实现</p><h2 id="控制audio-的paly和pause"><a href="#控制audio-的paly和pause" class="headerlink" title="控制audio 的paly和pause"></a>控制audio 的paly和pause</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;audio :src=<span class="string">&quot;props.src&quot;</span> ref=<span class="string">&quot;audio&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;plyr-audio&quot;</span> preload=<span class="string">&quot;auto&quot;</span> @timeupdate=<span class="string">&quot;timeupdate&quot;</span> /&gt;</span><br><span class="line"> <span class="language-xml"><span class="tag">&lt;<span class="name">DetaulCenter</span> <span class="attr">:orderStatus</span>=<span class="string">&quot;orderStatus&quot;</span> <span class="attr">:orderStatusVal</span>=<span class="string">&quot;musicStore.orderStatusVal&quot;</span> <span class="attr">:isPlay</span>=<span class="string">&quot;isPlay&quot;</span>    @<span class="attr">pause</span>=<span class="string">&quot;pause&quot;</span> @<span class="attr">play</span>=<span class="string">&quot;play&quot;</span> @<span class="attr">setOrderHandler</span>=<span class="string">&quot;setOrderHandler&quot;</span> /&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="comment">// 重写auido的暂停和播放</span></span><br><span class="line"><span class="keyword">export</span> type userAudio = &#123;</span><br><span class="line">  <span class="attr">play</span>: <span class="function">(<span class="params">lengthen?: boolean</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">  <span class="attr">pause</span>: <span class="function">(<span class="params">isNeed?: boolean, lengthen?: boolean</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">&#125; &amp; <span class="title class_">Omit</span>&lt;<span class="title class_">HTMLAudioElement</span>, <span class="string">&#x27;pause&#x27;</span> | <span class="string">&#x27;play&#x27;</span>&gt;  </span><br><span class="line"><span class="comment">// 播放状态</span></span><br><span class="line"><span class="keyword">const</span> isPlay = <span class="title function_">ref</span>(<span class="literal">false</span>)</span><br><span class="line"><span class="comment">// 播放器实例</span></span><br><span class="line"><span class="keyword">const</span> audio = ref&lt;userAudio&gt;()</span><br><span class="line"><span class="comment">// 播放器原始播放和暂停</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">originPlay</span>: <span class="title class_">HTMLMediaElement</span>[<span class="string">&#x27;play&#x27;</span>]</span><br><span class="line"><span class="keyword">let</span> <span class="attr">originPause</span>: <span class="title class_">HTMLMediaElement</span>[<span class="string">&#x27;pause&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  originPlay = audio.<span class="property">value</span>!.<span class="property">play</span> <span class="keyword">as</span> <span class="title class_">HTMLMediaElement</span>[<span class="string">&#x27;play&#x27;</span>]</span><br><span class="line">  originPause = audio.<span class="property">value</span>!.<span class="property">pause</span> <span class="keyword">as</span> <span class="title class_">HTMLMediaElement</span>[<span class="string">&#x27;pause&#x27;</span>]</span><br><span class="line">  audio.<span class="property">value</span>!.<span class="property">play</span> = play</span><br><span class="line">  audio.<span class="property">value</span>!.<span class="property">pause</span> = pause</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> userStore = <span class="title function_">useUserStore</span>()</span><br><span class="line"><span class="keyword">const</span> musicStore = <span class="title function_">useMusicStore</span>()</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">play</span> = (<span class="params">lengthen: boolean = <span class="literal">false</span></span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  originPlay.<span class="title function_">call</span>(audio.<span class="property">value</span>).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;调用origin.play方法时抛出了错误：&#x27;</span>, err)</span><br><span class="line">  &#125;)</span><br><span class="line">  isPlay.<span class="property">value</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">pause</span> = (<span class="params">isNeed: boolean = <span class="literal">true</span>, lengthen: boolean = <span class="literal">false</span></span>) =&gt; &#123;</span><br><span class="line">  originPause.<span class="title function_">call</span>(audio.<span class="property">value</span>)</span><br><span class="line">  isPlay.<span class="property">value</span> = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>为了方便更好的控制<code>audio</code>我们创建一个ref来控制该实例，我们这里是重写了原生的<strong>pause</strong>和<strong>play</strong>方法，想在播放和暂停时有个过渡的效果，这里先将原生的播放和暂停存起来，调用的方法还是比较简单。</p><h2 id="audioTimeupdate的功能实现以及存储当前播放时间"><a href="#audioTimeupdate的功能实现以及存储当前播放时间" class="headerlink" title="audioTimeupdate的功能实现以及存储当前播放时间"></a>audioTimeupdate的功能实现以及存储当前播放时间</h2><p>为了方便我全局可以方便控制播放器这个组件我将 audio还有他的一些属性向外暴露出去写成了一个全局的$audio</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MusicPlayer/index.vue</span></span><br><span class="line"><span class="keyword">const</span> exposeObj = &#123;</span><br><span class="line">  <span class="attr">el</span>: audio,</span><br><span class="line">  isPlay,</span><br><span class="line">  play,</span><br><span class="line">  pause,</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(exposeObj, <span class="string">&#x27;time&#x27;</span>, &#123;</span><br><span class="line">  <span class="title function_">get</span>(): number &#123;</span><br><span class="line">    <span class="keyword">return</span> audio.<span class="property">value</span>!.<span class="property">currentTime</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">set</span>(<span class="params">time: number</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      audio.<span class="property">value</span>!.<span class="property">currentTime</span> = time</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;设置time时出现了错误: &#x27;</span>, e, <span class="string">&#x27;,time: &#x27;</span>, time)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="title function_">defineExpose</span>(exposeObj)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// layout/index.vue</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 音乐播放器实例</span></span><br><span class="line"><span class="keyword">const</span> audioInstance = ref&lt;<span class="title class_">MusicPlayerInstanceType</span>&gt;()</span><br><span class="line"><span class="title function_">onMounted</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (audioInstance.<span class="property">value</span> !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">$audio</span> = audioInstance.<span class="property">value</span>!</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;初始化全局$audio：&#x27;</span>, <span class="variable language_">window</span>.<span class="property">$audio</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">getUserInfo</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这样我们在全局使用到该组件时可以通过window.$audio 来控制播放暂停。并且我们在通过<code>Object.defineProperty</code>在向外暴露的对象上加了一个time属性，方便我们来获取当前的currentTime和设置currentTime</p><p>好了回到我们要介绍的 timeupdate事件，当当前音频currentTime变化时会触发timeupdate的事件，在这里我们主要做的就是一件事就是将当前播放器的时间进行持久化存储</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MusicPlayer/index.vue</span></span><br><span class="line">&lt;<span class="title class_">DetailRight</span> :currentTime=<span class="string">&quot;musicStore.currentTime&quot;</span> :songs=<span class="string">&quot;props.songs&quot;</span> :audio=<span class="string">&quot;audio&quot;</span> /&gt;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> <span class="title function_">timeupdate</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  musicStore.<span class="property">currentTime</span> = <span class="variable language_">window</span>.<span class="property">$audio</span>.<span class="property">time</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> el = audio.<span class="property">value</span>!</span><br><span class="line"></span><br><span class="line">  el.<span class="title function_">addEventListener</span>(<span class="string">&#x27;loadedmetadata&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      musicStore.<span class="property">currentTime</span> &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">      musicStore.<span class="property">currentTime</span> &lt; el.<span class="property">duration</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      el.<span class="property">currentTime</span> = musicStore.<span class="property">currentTime</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//MusicPlayer/DetailRight.vue</span></span><br><span class="line"> &lt;div <span class="keyword">class</span>=<span class="string">&quot;timeBox flex text-[15px]&quot;</span>&gt;</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;props.songs?.ar&quot;</span> <span class="attr">class</span>=<span class="string">&quot;current-time&quot;</span>&gt;</span>&#123;&#123; formattingTime(props.currentTime * 1000) &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;margin: 0 5px;line-height: 24px&quot;</span>&gt;</span>/<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;props.songs?.ar&quot;</span> <span class="attr">class</span>=<span class="string">&quot;total-time&quot;</span>&gt;</span>&#123;&#123; formattingTime(props.songs.dt) &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &lt;/div&gt;</span><br></pre></td></tr></table></figure><p>这块我们主要来关注<code>onMounted</code>里面的,这里我们监听了loadedmetadata后再将audio的currentTime恢复这样保证了我们重启项目后可以保持之前的播放时间</p><img src="/assest/20260120/2.png" alt="listImg" style="width: 800px; height: 500px" /><p>有关timeUpdate那里可以使用节流优化优化一下，防止短时间多次改变store导致的性能问题</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> lastTime = <span class="title function_">ref</span>(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">timeupdate</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (timeState.<span class="property">stop</span> || <span class="built_in">isNaN</span>(<span class="variable language_">window</span>.<span class="property">$audio</span>.<span class="property">el</span>.<span class="property">duration</span>)) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">  <span class="comment">// 在更新 currentTime 之前，保存旧的值</span></span><br><span class="line">  <span class="keyword">const</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">  <span class="keyword">if</span> (now - lastTime.<span class="property">value</span> &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">    musicStore.<span class="property">currentTime</span> = <span class="variable language_">window</span>.<span class="property">$audio</span>.<span class="property">time</span></span><br><span class="line">    lastTime.<span class="property">value</span> = now</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>暂停时有一个过渡效果，不过目前暂时还没做先不用管</p>]]></content>
      
      
      <categories>
          
          <category> 日常 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>如何优化复杂数据渲染列表的卡顿-2</title>
      <link href="/2025/12/03/2025120302/"/>
      <url>/2025/12/03/2025120302/</url>
      
        <content type="html"><![CDATA[<p>  上一篇我们讨论了如何优化数据渲染卡顿，这里我们来讨论一下如何优化数据渲染卡顿，通常我们可能会想到使用虚拟列表来处理</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;content-box h-[calc(100%-80px)] overflow-auto overflow-y-auto px-[40px] pb-[80px]&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">router-view</span> <span class="attr">v-slot</span>=<span class="string">&quot;&#123; Component &#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">component</span> <span class="attr">:key</span>=<span class="string">&quot;refresh&quot;</span> <span class="attr">:is</span>=<span class="string">&quot;Component&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>  由于我的<code>router-view</code> 这块使用了calc来计算,electron可以改变窗口大小，而虚拟列表使用需要给出一个固定的高度，我这里使用不方便，所以我们必须另寻他路，上篇我们知道了导致卡顿的原因是渲染压力大，那我们从这里入手减小压力，我们听过大文件上传切片减小服务器的压力，这里我们一样，将列表的数据来分片渲染，我采用的是时间**分片（Time Slicing）**的优化思路，<code>RAF</code>来处理</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> chunkList = ref&lt;<span class="title class_">GetMusicDetailData</span>[]&gt;([])</span><br><span class="line"><span class="keyword">const</span> chunkSize = <span class="number">20</span></span><br><span class="line"><span class="keyword">let</span> rafId = <span class="number">0</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">renderChunked</span> = (<span class="params">fullList: GetMusicDetailData[]</span>) =&gt; &#123;</span><br><span class="line">  chunkList.<span class="property">value</span> = []</span><br><span class="line">  <span class="keyword">let</span> start = <span class="number">0</span></span><br><span class="line">  <span class="title function_">cancelAnimationFrame</span>(rafId)</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">appendChunk</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> next = fullList.<span class="title function_">slice</span>(start, start + chunkSize)</span><br><span class="line">    <span class="keyword">if</span> (!next.<span class="property">length</span>) <span class="keyword">return</span></span><br><span class="line">    chunkList.<span class="property">value</span>.<span class="title function_">push</span>(...next)</span><br><span class="line">    start += chunkSize</span><br><span class="line">    rafId = <span class="title function_">requestAnimationFrame</span>(appendChunk)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">appendChunk</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">watch</span>(<span class="function">() =&gt;</span> searchKey.<span class="property">value</span>, <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> key = val.<span class="title function_">trim</span>().<span class="title function_">toLowerCase</span>()</span><br><span class="line">  <span class="title function_">renderChunked</span>(</span><br><span class="line">    key ? mylist.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> item.<span class="property">_searchText</span>?.<span class="title function_">includes</span>(key)) : mylist.<span class="property">value</span></span><br><span class="line">  )</span><br><span class="line">&#125;, &#123; <span class="attr">immediate</span>: <span class="literal">true</span> &#125;)</span><br></pre></td></tr></table></figure><p>  首先我们创建一个chunkList存放我们的切片数据,这里我切片大小用了20,先看一下watch,先对searchKey进行监听，根据searchKey是否有值来将需要渲染的数据来切片，<code>immediate: true </code>让页面首次加载时就渲染一次数据，然后我们来看我们切片函数，在每次执行时都先清空之前的数据，然后用个闭包<code>appendChunk</code>里面来将外面传来的fullList使用slice进行切片，如果next是空数组则说明切片已经完成return跳出函数，这里就到了我们这个函数的最重要的部分了，前面只是切片了，如何让他分块渲染呢？这里我使用到了<code>requestAnimationFrame</code><br>  <code>window.requestAnimationFrame() 方法会告诉浏览器你希望执行一个动画。它要求浏览器在下一次重绘之前，调用用户提供的回调函数。</code>这是我截取mdn上对<code>requestAnimationFrame</code>的介绍，让浏览器一帧完成一次我们的渲染，这样就减小了浏览器一次性渲染大量 DOM导致的压力，你可能会问那这么多次渲染浏览器重绘渲染这么多次会有性能问题吗？我这里将每次只处理20条数据可能只需要2ms，而浏览器有16ms来一帧渲染，而且更新的dom少回流重绘范围小这里不会产生性能问题。分块渲染不是减少回流，而是把“不可避免的巨大回流”拆成许多“小而快的回流”。只要每次更新足够小，就不会阻塞主线程，也不会掉帧，页面就会流畅。<br>之后就是其他问题的处理了，我们需要使用<code>cancelAnimationFrame</code>来取消之前的还在排队的RAF，来解决 出现旧数据混入、闪动、顺序错乱 现象，所以我们在调用<code>renderChunked</code>时都要将上一次的切片清空。<br><img src="/assest/20251203/afterGif.gif" alt="listImg" style="width: 800px; height: 500px" /><br>  我们可以清楚的看到相比之前这次的渲染十分流程，这样一个简单的分块渲染就完成了。</p>]]></content>
      
      
      <categories>
          
          <category> 日常 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>如何优化复杂数据渲染列表的卡顿-1</title>
      <link href="/2025/12/03/2025120301/"/>
      <url>/2025/12/03/2025120301/</url>
      
        <content type="html"><![CDATA[<img src="/assest/20251203/listImg.png" alt="listImg" style="width: 800px; height: 500px" />  最近在写一个模仿网易云音乐软件的项目,在写到音乐列表页面时碰到一个问题,可以看到我的这个音乐列表渲染的数据有点复杂，有个搜索当我在搜索时对数据过滤渲染，当我比如说清除搜索条件或者是删除搜索框最后一个字符时会卡顿一下再将数据加载出来<img src="/assest/20251203/beforeGif.gif" alt="listImg" style="width: 800px; height: 500px" />可以很清楚的看到明显的一个卡顿，那为什么会存在这个问题呢？首先我们先来看一下我最开始如何写的搜索代码<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> filterList = ref&lt;<span class="title class_">GetMusicDetailData</span>[]&gt;([])</span><br><span class="line"> <span class="comment">// 搜索音乐</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleSearch</span> = (<span class="params">val</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!val.<span class="title function_">trim</span>().<span class="property">length</span>) &#123;</span><br><span class="line">   filterList.<span class="property">value</span> = mylist.<span class="property">value</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    filterList.<span class="property">value</span> = mylist.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> alName = item.<span class="property">al</span>?.<span class="property">name</span> || <span class="string">&#x27; &#x27;</span></span><br><span class="line">      <span class="keyword">const</span> keywords = [item.<span class="property">name</span>?.<span class="title function_">toLowerCase</span>(), alName.<span class="title function_">toLowerCase</span>()]</span><br><span class="line">     item.<span class="property">ar</span>?.<span class="title function_">forEach</span>(<span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (a.<span class="property">name</span>) &#123;</span><br><span class="line">         keywords.<span class="title function_">push</span>(a.<span class="property">name</span>.<span class="title function_">toLowerCase</span>())</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;)</span><br><span class="line">      <span class="keyword">return</span> keywords.<span class="title function_">some</span>(<span class="function">(<span class="params">keyword</span>) =&gt;</span> keyword.<span class="title function_">includes</span>(val?.<span class="title function_">toLowerCase</span>()))</span><br><span class="line">    &#125;)</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>  这里我创建了一个filterList处理数组，然后对input进行监听 如果输入的全是空格或者没有值就全部渲染，否则就进行过滤将 歌曲名字专辑名歌手名当成关键词然后使用``Array.prototype.some``进行判断存在就渲染首先就是第一个可以优化的地方了,每次搜索都会创建一个keywords的数组，这里其实可以将这一步预处理<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mylist.<span class="property">value</span> = props.<span class="property">list</span>.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> (&#123;</span><br><span class="line">  ...item,</span><br><span class="line">  <span class="attr">_duration</span>: <span class="title function_">formattingTime</span>(item.<span class="property">dt</span>),</span><br><span class="line">  <span class="attr">_searchText</span>: [</span><br><span class="line">    item.<span class="property">name</span>?.<span class="title function_">toLowerCase</span>() || <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    item.<span class="property">al</span>?.<span class="property">name</span>?.<span class="title function_">toLowerCase</span>() || <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    ...(item.<span class="property">ar</span>?.<span class="title function_">map</span>(<span class="function"><span class="params">a</span> =&gt;</span> a.<span class="property">name</span>?.<span class="title function_">toLowerCase</span>() || <span class="string">&#x27;&#x27;</span>) || [])</span><br><span class="line">  ].<span class="title function_">join</span>(<span class="string">&#x27; &#x27;</span>) <span class="comment">//预处理搜索关键词</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><p>  这样就减少没必要了重复操作，好了回归正题，为什么会出现卡顿呢？这就涉及到浏览器的渲染原理了，我们知道浏览器的<strong>渲染主线程</strong>是单线程的，这里卡顿实际上vue里面<code>keywords</code>和<code>filterList</code>已经是新数据了，但是由于数据量大和复杂，可能我听歌也不多我喜欢的音乐列表就300多条数据，如果其他上千的那会卡顿很久了，vue生成虚拟DOM然后 diff &#x2F; patch ，更新真实DOM，浏览器之后才会重新渲染 ，这就阻塞了主线程的渲染从而导致卡顿。 </p><p> 正好提到了<strong>js的单线程和浏览器渲染</strong>我们再引申一下，讲一下我之前遇到的一个相关问题</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;flag = !flag&quot;</span>&gt;</span>切换<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    显示</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span> <span class="attr">ref</span>=<span class="string">&quot;hideRef&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    隐藏</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref, watch &#125; from &#x27;vue&#x27;</span><br><span class="line">const hideRef = ref&lt;HTMLDivElement&gt;()</span><br><span class="line">const flag = ref&lt;boolean&gt;(true)</span><br><span class="line">watch(flag, (newVal) =&gt; &#123;</span><br><span class="line">   if (!newVal) &#123;</span><br><span class="line">    hideRef.value.classList.add(&#x27;hide&#x27;)</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>  这写了一个简单的demo，我们这里watch监听flag,当隐藏时给hideRef添加一个hide类，这力就有问题了，js从上到下依次执行，当我们执行到watch的时候flag是false往里面走,因为浏览器还没有将hideRef渲染出来，这里就对ref操作会报错，我们必须要让浏览器完成渲染后再进行操作，这里我们可以使用<code>nextTick/flush: &#39;post&#39;</code>来等浏览器渲染完后再对ref操作</p><p>  这篇我们先了解了一下为什么会导致卡顿，提出了一个数据优化的技巧，了解了浏览器渲染的一些知识，下一章我们来看一下我是怎么处理该问题的。</p>]]></content>
      
      
      <categories>
          
          <category> 日常 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue 全局组件注册</title>
      <link href="/2025/09/30/20250930/"/>
      <url>/2025/09/30/20250930/</url>
      
        <content type="html"><![CDATA[<p>在写项目时遇到一个问题，先来看两段代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// search/index.vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;search-container flex items-center px-[15px]&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">el-icon</span> <span class="attr">class</span>=<span class="string">&quot;search-icon cursor-pointer&quot;</span> <span class="attr">size</span>=<span class="string">&quot;18px&quot;</span> <span class="attr">color</span>=<span class="string">&quot;rgba(255, 255, 255, 0.5)&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Search</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">class</span>=<span class="string">&quot;search-input bg-transparent w-[230px] h-[37px] pl-[10px] outline-none border-none font-size-[14px] text-white placeholder:text-white/50&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">:placeholder</span>=<span class="string">&quot;placeholderInfo.showKeyword&quot;</span> <span class="attr">v-model.trim</span>=<span class="string">&quot;keywords&quot;</span> @<span class="attr">focus</span>=<span class="string">&quot;focusHandler&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      @<span class="attr">blur</span>=<span class="string">&quot;blurHandler&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">el-icon</span> <span class="attr">class</span>=<span class="string">&quot;clean-icon cursor-pointer&quot;</span> <span class="attr">size</span>=<span class="string">&quot;18px&quot;</span> <span class="attr">color</span>=<span class="string">&quot;rgba(255, 255, 255, 0.5)&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:class</span>=<span class="string">&quot;&#123; visible: keywords &#125;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;keywords = &#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">CircleCloseFilled</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;suggest&quot;</span> <span class="attr">v-show</span>=<span class="string">&quot;showSuggest&quot;</span> <span class="attr">v-loading</span>=<span class="string">&quot;loading&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">list</span> <span class="attr">:list</span>=<span class="string">&quot;state.list&quot;</span> <span class="attr">:model</span>=<span class="string">&quot;model&quot;</span> <span class="attr">:keywordsList</span>=<span class="string">&quot;state.keywordsList&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// search/list.vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;search-list h-full overflow-hidden py-[20px] px-[10px]&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;model === &#x27;hot&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hot-list&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hot-title mb-[10px]&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          热搜</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hot-list-item flex items-center cursor-pointer h-[60px]&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in props.list&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item-index mr-[20px]&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123; &#x27;top3&#x27;: index &lt; 3 &#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;&#123; index + 1 &#125;&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;item-content&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;title flex items-center&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;name font-[600] text-[14px] mr-[5px]&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;&#123; item.searchWord &#125;&#125;</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-if</span>=<span class="string">&quot;item.iconUrl&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;item.iconUrl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;icon size-[13px]&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;desc text-[11px] &quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              &#123;&#123; item.content &#125;&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;keyWords-list&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;keyWords-item flex items-center cursor-pointer h-[60px]&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, index) in props.keywordsList&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">el-icon</span> <span class="attr">size</span>=<span class="string">&quot;14px&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mr-[5px]&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Search</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;&#123; item.keyword &#125;&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>下面的的list是index所使用的局部组件，可以看到 这里都用上了<code>el-icon Search</code> 这个图标 但是在子组件里面渲染的是<code>index.vue</code>的内容 ，导致这样的现象是因为我使用了vue自动注册组件插件将 <code>src\component</code> 里面的组件都自动注册了全局组件，由于 <code>index.vue</code>的文件名是<code>search</code>导致后注册的组件覆盖了<code>element icon Search</code>所以导致了这里面渲染了<code>index.vue</code>的内容，这就导致我的疑问，为什么子组件调用时覆盖了，但是我在<code>index.vue</code>使用确是<code>element icon</code></p><p>首先我们来先了解一下vue组件的调用</p><p><code>首先vue会去找局部注册组件也就是import的</code></p><p><code>没找到就会去全局注册组件里面去找</code></p><p>这时vue的编辑器会有一个特殊机制去寻找一个不是组件本身但是同名的组件避免无限递归导致栈溢出， 由于我在<code>main.ts</code>里面注册了element的icon所以在list.vue里面没有达到我想要的效果，那解决这样的问题就很容易了将Search文件夹换名就行</p><p>x</p>]]></content>
      
      
      <categories>
          
          <category> 日常 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>通过Map处理数据更新</title>
      <link href="/2025/09/18/20250918%E5%B7%A5%E4%BD%9C/"/>
      <url>/2025/09/18/20250918%E5%B7%A5%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<p>在处理列表新增时遇到一个这个问题，通过组件选中的数据来新增，已经勾选过的组件还是勾上的，带出的数据是选中的数据，这时就有问题你不能简单的通过将选中的数据push到一个数组里面就可以，当用户选了一个数据又再次勾选时，你会有重复数据，当用户取消勾选时你获取到的是空数组，也不能使用直接将选择出来的数组直接替代，如果用户有编辑数据会导致数据丢失影响体验，这个时候就需要使用Map数据结构来进行处理了</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">checkInspection</span>(<span class="params">checkNames, checkData</span>) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 首先 创建一个Map</span></span><br><span class="line">      <span class="keyword">const</span> existingMap = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">checkInspectionList</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">keypointItemId</span>) &#123;</span><br><span class="line">          <span class="comment">// 将列表里面的id为键 将数组进行保存</span></span><br><span class="line">          existingMap.<span class="title function_">set</span>(item.<span class="property">keypointItemId</span>, item);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 处理逻辑：</span></span><br><span class="line">      <span class="comment">// 1. 仅保留checkData中存在的项（自动删除缺失项）</span></span><br><span class="line">      <span class="comment">// 2. 对存在的项进行属性更新</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">checkInspectionList</span> = checkData.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; keypointItemId &#125; = item;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="comment">// 这块判断勾选的数据之前已经存在就将数据return出去</span></span><br><span class="line">        <span class="comment">// 复用并更新已有项（保持引用一致性）</span></span><br><span class="line">        <span class="keyword">if</span> (existingMap.<span class="title function_">has</span>(keypointItemId)) &#123;</span><br><span class="line">          <span class="keyword">const</span> existingItem = existingMap.<span class="title function_">get</span>(keypointItemId);</span><br><span class="line">          <span class="keyword">return</span> &#123; ...existingItem, ...item &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 新增项初始化 </span></span><br><span class="line">        <span class="keyword">return</span> &#123; ...item, <span class="attr">isProblem</span>: <span class="number">0</span>, <span class="attr">isDelete</span>: <span class="number">1</span>, <span class="attr">delFlag</span>: <span class="number">0</span>, <span class="attr">problemType</span>: <span class="number">1</span>, &#125;;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><p>这块是直接对组件的数据进行map遍历，这样就做到了删除，更新的操作，<code>existingMap.has</code>存在则复用数据</p>]]></content>
      
      
      <categories>
          
          <category> 工作 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>about</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>daily</title>
      <link href="/daily/index.html"/>
      <url>/daily/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>link</title>
      <link href="/link/index.html"/>
      <url>/link/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>music</title>
      <link href="/music/index-1.html"/>
      <url>/music/index-1.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>music</title>
      <link href="/music/index.html"/>
      <url>/music/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>tags</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[<p>111</p>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>work</title>
      <link href="/work/index.html"/>
      <url>/work/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
